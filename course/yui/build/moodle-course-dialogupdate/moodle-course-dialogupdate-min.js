YUI.add("moodle-course-dialogupdate",function(Y,NAME){var CSS={PANELCONTENT:"#panelContentUpdate",PANELHEADER:"#panelContentUpdate .yui3-widget-hd",FORMOPPONENT:"#mform1",FORMCONTAINER:"#panelContentUpdate #mform1",SUBMITBUTTON2:"#panelContentUpdate .hidden  #id_submitbutton2",SUBMITBUTTON:"#panelContentUpdate .hidden  #id_submitbutton",CANCELBUTTON:"#panelContentUpdate .hidden  #id_cancel",CANCELBUTTON2:"#panelContentUpdate .yui3-widget-hd .yui3-button.yui3-button-close",COURSEVIEW:"#page-course-view-weeks",FORM:"mform1",INITBUTTON:"a.editing_update.menu-action.cm-edit-action",DUPLICATEBUTTON:"a.editing_duplicate.menu-action.cm-edit-action",SESSKEY:"#panelContentUpdate form#mform1 input[name=sesskey]",COURSEID:"#panelContentUpdate form#mform1 input[name=course]",UPDATE:"#panelContentUpdate form#mform1 input[name=update]",MODULENAME:"#panelContentAdd form#mform1 input[type=hidden][name=modulename]"},DIALOGNAME="course-dialogupdate",DIALOG=function(){DIALOG.superclass.constructor.apply(this,arguments)};Y.extend(DIALOG,Y.Base,{get_query_params:function(a){var b={},a=document.URL,c=a.substr(a.search("\\?")+1).split("&");for(var d in c){var e=c[d].split("=");b[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return b},change_submit:function(){Y.on("domready",function(){Y.one(CSS.SUBMITBUTTON2).on("click",this.submit_click,this)},this)},submit_click:function(e){var validatorName="validate_mod_"+modulename+"_mod_form";if(eval(validatorName)()){e.preventDefault(),Y.one(CSS.CANCELBUTTON).set("disabled","disabled"),null!==Y.one(CSS.SUBMITBUTTON)&&Y.one(CSS.SUBMITBUTTON).set("disabled","disabled");var courseId=Y.one(CSS.COURSEID).get("value"),sesskey=Y.one(CSS.SESSKEY).get("value"),update=Y.one(CSS.UPDATE).get("value");alert(update);var cfg={method:"post",on:{success:this.post_success},arguments:this,form:{id:CSS.FORM}};Y.io(M.cfg.wwwroot+"/course/rest.php?class=updatemodule&courseId="+courseId+"&sesskey="+sesskey+"&update="+update,cfg)}},post_success:function(a,b,c){if(b.responseText.indexOf(CSS.FORM)===-1){var d={on:{success:c.update_course}},e={},f=document.URL,g=f.substr(f.indexOf("?")+1).split("&");for(var h in g){var i=g[h].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}Y.io(M.cfg.wwwroot+"/course/view.php?id="+e.id,d)}else c.show_form(a,b)},update_course:function(a,b){document.open(),document.write(b.responseText),document.close()},show_form:function(a,b){var c=JSON.parse(b.responseText);null!==Y.one(CSS.PANELCONTENT)&&Y.one(CSS.PANELCONTENT).remove();for(var d=Y.all(CSS.FORMOPPONENT),e=0;e<d.size();e++)d.item(e).remove();null!==Y.one(CSS.JSVALIDATE)&&(Y.one(CSS.JSVALIDATE).remove(),Y.one(CSS.JSFORM).remove());var f=Y.Node.create("<div>");f.set("id","panelContentUpdate"),Y.one(CSS.COURSEVIEW).appendChild(f),f.setContent(c.html),Y.one(CSS.FORMCONTAINER).setStyle("height","80%"),Y.one(CSS.FORMCONTAINER).setStyle("padding-left","30px"),Y.one(CSS.FORMCONTAINER).setStyle("padding-right","30px"),Y.one(CSS.FORMCONTAINER).setStyle("overflow","auto");var g=new Y.Panel({srcNode:CSS.PANELCONTENT,headerContent:"Edit",width:1e3,zIndex:5,centered:!0,modal:!0,visible:!1,render:!0,plugins:[]});Y.one(CSS.PANELCONTENT).getY()<50&&Y.one(CSS.PANELCONTENT).setY(50),Y.one(CSS.PANELCONTENT).setStyle("padding-bottom","10px"),Y.one(CSS.PANELCONTENT).setStyle("border-radius","10px"),Y.one(CSS.PANELHEADER).setStyle("border-radius","10px 10px 0px 0px"),g.show(),Y.fire("domready"),Y.one(CSS.CANCELBUTTON).on("click",function(a){a.preventDefault(),g.hide()}),Y.one(CSS.CANCELBUTTON2).on("click",function(a){a.preventDefault(),g.hide()});var h=document.createElement("script");h.textContent=c.script,document.body.appendChild(h)},on_click:function(a,b){a.preventDefault();var c={on:{success:b.show_form},arguments:b},d={},e=document.URL,f=e.substr(e.search("\\?")+1).split("&");for(var g in f){var h=f[g].split("=");d[decodeURIComponent(h[0])]=decodeURIComponent(h[1])}var i=this.get("href");Y.io(M.cfg.wwwroot+"/course/rest.php"+i.substr(i.indexOf("?"))+"&class=updatemodule&courseId="+d.id,c)},init:function(){M.course.coursebase.register_module(this)},setupDialog:function(a,b){if("undefined"!=typeof a&&b==Y.all(CSS.INITBUTTON).size())Y.later(500,this,this.setupDialog,[a,b]);else{for(var c=Y.all(CSS.INITBUTTON),d=0;d<c.size();d++)c.item(d).detach("click"),c.item(d).on("click",this.on_click,c.item(d),this);this.setupDuplicate()}},setupDuplicate:function(){for(var a=Y.all(CSS.DUPLICATEBUTTON),b=Y.all(CSS.INITBUTTON).size(),c=0;c<a.size();c++)a.item(c).once("click",this.setupDialog,this,b)}},{NAME:DIALOGNAME,ATTRS:{maxheight:{value:800}}}),M.course=M.course||{},M.course.dialogupdate=function(a){return new DIALOG(a)}},"@VERSION@",{requires:["io-base","io-form"]});